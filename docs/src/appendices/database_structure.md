<a id="_database_structure"></a>
## Database structure

This section gives an detailed overview about the different C2MON database tables.

Usually, the server makes only use of this table at startup to initialize the In-Memory cache.
Furthermore, it is used to backup every 10 seconds the latest tag updates for eventual cache recovery.

The tables are completely controlled by the server layer and administrators should not try to do manual changes at runtime.
In general, configuration changes should always be done through the server Configuration module.
However, for testing purposes it might be interesting to directly manipulate the tables (see also Process <<guides.md#_data_configuration_, Data Configuration>>).

> **Please note!**

>The listed tables are only read at startup in case the In-Memory cache has not yet been initialized.
>Apart from that, the server does only depend on the database access for making data backups.



### The DATATAG table

The DATATAG table is a non-normalized table in order to facilitate the write of search queries.
The table contains all configured DataTags, ControlTags and RuleTags.
Only CommandTags are stored in a separate table.

| Columns Name | Description | Type | Not NULL? |
| ------------ | ----------- | ---- | --------- |
| TAGID | Unique tag identification key | NUMBER(9) | x |
| TAGNAME | Unique tag name | VARCHAR2(60) | x |
| TAGDESC | A short static description of the tag | VARCHAR2(100) |
| TAGMODE | Indicates the mode of the tag. Only the following values are allowed: <br> 0 - OPERATIONAL<br> 1 - MAINTENANCE<br> 2 - TEST | NUMBER(1) | x |
| TAGDATATYPE | The value type of the data which will be received by the given tag. The latest value will be stored as backup every 10 seconds in the TAGVALUE column. Only the following types are currently supported: `Boolean`, `Double`, `Float`, `Integer`, `Long`, `String` | VARCHAR2(20) | x |
| TAGCONTROLTAG | This flag indicates whether the tag is a ControlTag or not. Only the following values are allowed: <br> 0 - No control tag<br> 1 - The tag is a control tag |NUMBER(1)  | x |
| TAGVALUE | The latest value that will be stored by C2MON as backup every 10 seconds. | BLOB |
| TAGVALUEDESC | The tag value description that was received from the DAQ for the given value. | VARCHAR2(200) |
| TAGTIMESTAMP | The source timestamp of the given value or null if the update was not generated by the source (e.g. in case of a communication fault) | TIMESTAMP(6) |
| TAGDAQTIMESTAMP | The time when the DAQ has received the tag value update or null if the update was not generated by the DAQ (e.g. in case of a communication fault) | TIMESTAMP(6) |
| TAGSRVTIMESTAMP | The time when the server has updated the tag value in the In-Memory cache. This timestamp normally always set. | TIMESTAMP(6) |
| TAGQUALITYCODE | **Obsolete!** Will be removed with the next revision | NUMBER(3) |
| TAGQUALITYDESC | A JSON string set by the server containing all quality flags + description that are currently set. If everything is OK, this field will only contain empty brackets {}.<br>Example for a tag flagged with bad quality:<br>`{"VALUE_OUT_OF_BOUNDS":"source value is out of bounds (min: -10.0 max: 50.0)"}` | VARCHAR2(1000) |
| TAGRULE | In case that the tag is a RuleTag this field will contain the rule as string. <br>Example:<br> `(#163174 > 6)[0], (#163174 <= 6) & (#163174 >= 5)[2], (#163174 < 5)[3]` | VARCHAR2(4000) |
| TAGRULEIDS | In case the given tag is used within one or many rules, the server will store here the RuleTag IDs in a comma separated list.<br>Example:<br>`90534, 90406, 163442` | VARCHAR2(500) |
| TAG_EQID | The unique ID of the equipment, to which the tag is associated. **This field is empty**, if the tag is:<br> a RuleTag<br> a Process AliveTag<br> a Process StatusTag |NUMBER(9) |
| TAGMINVAL | In case the tag type is numeric it is possible to define a minimum value. The tag will then be invalidated, if the received value is below the defined minimum. | BLOB |
| TAGMAXVAL | In case the tag type is numeric it is possible to define a maximum value. The tag will then be invalidated, if the received value is above the defined maximum. | BLOB |
| TAGUNIT | A free text unit definition. <br>Examples: `kg`, `Celsius`, `km/h` | VARCHAR2(50) |
| TAGSIMULATED | This flag indicates whether the current tag value is real or simulated:<br> 0 - Not simulated<br>1 - Simulated value | NUMBER(1) |
| TAGLOGGED | This flag indicates whether the data updates received for this tag shall be kept in the history table or not. Usually this is not the case for AliveTags, since it is later on possible to compute the uptime statistic from the StatusTags<br>0 - tag values not logged<br> 1 - tag values logged | NUMBER(1) |
| TAGVALUEDICTIONARY | An XML representation of a value dictionary. This is interesting, if you want to display on your client application a more human readable message than the raw value received from the underlying source. Examples:<br>`<DataTagValueDictionary>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<entry type="Boolean" key="false">ABSENT</entry>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<entry type="Boolean" key="true">PRESENT</entry>`<br>`</DataTagValueDictionary>`<br>`<DataTagValueDictionary>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<entry type="Integer" key="1">OFF</entry>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<entry type="Integer" key="2">ON</entry>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<entry type="Integer" key="3">Invalid</entry>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<entry type="Integer" key="0">Invalid</entry>`<br>`</DataTagValueDictionary>` | NUMBER(1000) |
| TAGADDRESS | The hardware address as XML of the given DataTag or AliveTag. Please notice that RuleTags, StatusTags and CommFaultTags do not have by definition an address. Even for (Sub-)Equipment AliveTags it is not absolutely mandatory to define an address, since the alive trigger could be implemented without an explicit subscription. <br>Here an example of how the hardware address XML string could look like:<br>`<DataTagAddress>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<HardwareAddress class="cern.c2mon.shared.common.datatag.address.impl.PLCHardwareAddressImpl">`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<block-type>5</block-type>`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<word-id>9</word-id>`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<bit-id>10</bit-id>`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<physical-min-val>0.0</physical-min-val>`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<physical-max-val>0.0</physical-max-val>`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<resolution-factor>1</resolution-factor>`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<native-address>INT999</native-address>`<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`<command-pulse-length>0</command-pulse-length>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`</HardwareAddress>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<time-to-live>9999999</time-to-live>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<priority>7</priority>`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<guaranteed-delivery>true</guaranteed-delivery>`<br>`</DataTagAddress>` | VARCHAR2(4000) |
| TAGDIPADDRESS | *Only for CERN internal usage. Should be removed from this table one day* | VARCHAR2(500) |
| TAGJAPCADDRESS | *Only for CERN internal usage. Should be removed from this table one day* | VARCHAR2(500) |





### The PROCESS table

| Columns Name | Description | Type | Not NULL? |
| ------------ | ----------- | ---- | --------- |
| PROCID | Unique Process identification key | NUMBER(9) | x |
| PROCNAME | Unique Process name | VARCHAR2(60) | x |
| PROCDESC | Process description | VARCHAR2(100) |
| PROCSTATE_TAGID | ID of Process StatusTag | NUMBER(9) | x |
| PROCALIVE_TAGID | ID of Process AliveTag | NUMBER(9) |
| PROCALIVEINTERVAL | Alive interval (heartbeat) in milliseconds. | NUMBER(7) |
| PROCMAXMSGSIZE |This value determines the amount of messages that the given DAQ Process is allowed to accumulate before sending it to the C2MON server tier. Please notice, that the message buffering mechanism is also influenced by the PROCMAXMSGDELAY value (see below).<br>A good default value is 100. | NUMBER(5) | x |
| PROCMAXMSGDELAY | This value will set the maximum allowed delivery delay in milliseconds of the internal DAQ process message buffer for received source value updates.<br>The minimum is currently hard-coded to 200 milliseconds. A good default value is 1000. Please read also the section about Message prioritisation. | NUMBER(7) | x |
| PROCCURRENTHOST | C2MON stores here the name of the host on which the DAQ Process is running. | VARCHAR2(25) |
| PROCSTATE | The current Process status set by the server, which can also be retrieved from the corresponding StatusTag.<br>Possible status are:<br> DOWN, RUNNING, RUNNING_LOCAL, STARTUP |VARCHAR2(20) |
| PROCSTARTUPTIME | The time, when the DAQ Process has been started | TIMESTAMP(6) |
| PROCREBOOT | Is set to 1 by the server in case the DAQ Process requires a reboot after re-configuration. Otherwise the value is 0. | NUMBER(1) |
| PROCSTATUSTIME | The timestamp indicates, when the Process status has been changed the last time | TIMESTAMP(6) |
| PROCSTATUSDESC | The status description of the Process, which is similar to the value description of the Process StatusTag | VARCHAR2(300) |
| PROCPIK | A unique Process communication key that gets generated during the handshake phase.<br>Every update message coming from the DAQ will contain this Process PIK in the message header. | NUMBER(10) |
| PROCLOCALCONFIG | This field will be set by the server. <br>The following two states are possible:<br> 'N' - The DAQ process requested the configuration by the server<br> 'Y' - The DAQ process is running with a local configuration | VARCHAR2(1) |





### The EQUIPMENT table

| Columns Name | Description | Type | Not NULL? |
| ------------ | ----------- | ---- | --------- |
| EQID | Unique Equipment identification key | NUMBER(9) | x |
| EQNAME | Unique Equipment name | VARCHAR2(60) | x |
| EQDESC | Equipment description | VARCHAR2(100) |
| EQHANDLERCLASS | The Java Equipment handler Class name.<br>That one is passed to the DAQ Process which will create an instance through reflection by passing the Equipment address string (see EQADDRESS). | VARCHAR2(100) | x |
| EQADDRESS | A free text field for passing additional parameters needed for connecting the Equipment handler class with the real equipment. It is up to the EquipmentMessageHandler implementation how this string has to look like.<br>Here an example from the JECMessageHandler:<br> `plc_name=APIMMD26;Protocol=SiemensISO;Time_sync=Jec;Port=102;S_tsap=TCP-1;D_tsap=TCP-1;Alive_handler_period=5000;Dp_slave_address=4,5;` | VARCHAR2(900) |
| EQSTATE_TAGID | ID of Equipment StatusTag | NUMBER(9) | x |
| EQALIVE_TAGID | ID of the Equipment AliveTag | NUMBER(9) |
| EQALIVEINTERVAL | Alive interval (heartbeat) in milliseconds. | NUMBER(7) |
| EQ_PROCID | The Process ID to which the Equipment is attached.<br>NNt used in case of a Sub-Equipment. | NUMBER(9) |
| EQCOMMFAULT_TAGID | ID of the Equipment CommFaultTag | NUMBER(9) |
| EQ_PARENT_ID | In case of a Sub-Equipment it contains the ID of the parent Equipment.<br>Please note, that Sub-Equipments do not have an EQ_PROCID and neither a EQADDRESS specified. | NUMBER(10) |
| EQSTATE | The current Equipment status set by the server, which can also be retrieved from the corresponding StatusTag.<br>Possible status are:<br> DOWN, RUNNING | VARCHAR2(20) |
| EQSTATUSTIME | The timestamp indicates, when the Equipment status has been changed the last time | TIMESTAMP(6) |
| EQSTATUSDESC |The status description of the Equipment, which is similar to the value description of the Equipment StatusTag |VARCHAR2(300) |





### The ALARM table

Please read also <<overview.md#_alarms, Core Concepts: Alarms>> for more information about for instance the triplet concept of Fault Family / Fault Member / Fault Code

| Columns Name | Description |Type | Not NULL? |
| ------------ | ----------- |---- | --------- |
| ALARMID | Unique Alarm identification key | NUMBER(9) | x |
| ALARM_TAGID | ID of the DATATAG to which this alarm is attached | NUMBER(9) |
| ALARMFFAMILY | The alarm Fault family | VARCHAR2(20) | x |
| ALARMFMEMBER | The alarm Fault member | VARCHAR2(64) | x |
| ALARMFCODE | The alarm Fault code | NUMBER(9) | x |
| ALARMSTATE | Either \'ACTIVE' or \'TERMINATE' | VARCHAR2(10) |
| ALARMTIME | The time when the alarm was activated or terminated | VARCHAR2(6) |
| ALARMINFO | A free text field that is used by C2MON to store additional alarm information, that is:<br> '[T]' : Indicates that the associated Tag is in TEST mode<br> '[?]' : Indicates that the associated Tag has bad quality (invalid) e.g. due to an Equipment communication failure| VARCHAR2(100) |
| ALARMCONDITION | Configuration for the AlarmCondition class that is specified as XML.<br>Below you see examples for `ValueAlarmCondition` and  `RangeAlarmCondition`, which specify when an alarm shall be set to ACTIVE.<br>Please note, that only one definition will can be set per alarm:<br>`<AlarmCondition class="cern.c2mon.server.common.alarm.ValueAlarmCondition">`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<alarm-value type="Boolean">true</alarm-value>`<br>`</AlarmCondition>`<br><br>`<AlarmCondition class="cern.c2mon.server.common.alarm.ValueAlarmCondition">`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<alarm-value type="String">DOWN</alarm-value>`<br>`</AlarmCondition>`<br><br>`<AlarmCondition class="cern.c2mon.server.common.alarm.ValueAlarmCondition">`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<alarm-value type="Integer">1</alarm-value>`<br><br>`</AlarmCondition>`<br>`<AlarmCondition class="cern.c2mon.server.common.alarm.RangeAlarmCondition">`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<max-value type="Float">5.0</max-value>`<br>`</AlarmCondition>`<br><br>`<AlarmCondition class="cern.c2mon.server.common.alarm.RangeAlarmCondition">`<br>&nbsp;&nbsp;&nbsp;&nbsp;`<min-value type="Integer">10</max-value>`<br>`</AlarmCondition>`<br>| VARCHAR2(500) |
| ALA_PUBLISHED | _Please note, that this field is only relevant, if the C2MON system has an alarm publication module implemented._<br>Flag indicating, whether the computed alarm has already been published through a dedicated publication module. Possible values are:<br> 0 - Alarm has not yet been sent<br> 1 - Alarm is published | NUMBER(1) |
| ALA_PUB_STATE | _Please note, that this field is only relevant, if the C2MON system has an alarm publication module implemented._<br>The last state that was published. See also ALARMSTATE | VARCHAR2(10) |
| ALA_PUB_TIME | _Please note, that this field is only relevant, if the C2MON system has an alarm publication module implemented._<br> The time of the last alarm publication | TIMESTAMP(6) |
| ALA_PUB_INFO | _Please note, that this field is only relevant, if the C2MON system has an alarm publication module implemented._<br>The last alarm information being published. See also ALARMINFO |VARCHAR2(100) |
