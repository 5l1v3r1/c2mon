<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">

<!--
  INSTRUCTIONS:

  Specify the name of the log file in the ${c2mon.log.file} system property.
  To do this, start your program the following way:

    java -Dc2mon.log.file=c:/tim.log ... YourMainClass
  or
    java -Dc2mon.log.file=c:/tim.log ... -jar YourRunnableJar.jar

  If you don't, the log file will be created in the temp directory. If this 
  isn't possible either, log output will be printed on the console.

  Messages are written to the log file in an asynchronous way (no flush after
  every line). To avoid losing messages when the program exits, you have to 
  shutdown the loggers properly before the program terminates. The statement

    LogManager.getLoggerRepository.shutdown();

  closes all loggers and flushes all buffers. If the program crashes violently,
  you might lose some messages that were not written to the file yet.

-->

<!-- 

  Set the threshold to "info" in production system. This will filter out all 
  debug messages. If you only want to enable/disable debugging for certain
  parts of the system, change the "level" attribute of the appropriate logger.

-->
<log4j:configuration debug="false" 
                     threshold="debug"
                     xmlns:log4j='http://jakarta.apache.org/log4j/'>

  <renderer  renderedClass="cern.c2mon.shared.daq.datatag.SourceDataTagValue"
             renderingClass="cern.c2mon.shared.daq.datatag.SourceDataTagValueRenderer" />
             
  <renderer  renderedClass="cern.c2mon.server.common.rule.RuleTag"
             renderingClass="cern.c2mon.server.common.rule.RuleTagRenderer" />
             
  <renderer  renderedClass="cern.c2mon.server.common.alarm.Alarm"
             renderingClass="cern.c2mon.server.common.alarm.renderer.AlarmRenderer" />
                                          
             
  <appender name="FileAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
    <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/c2mon.log" />
    <param name="MaxBackupIndex" value="10" />
    <param name="MaxFileSize" value="50MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %c [%t] %x - %m%n"/>
    </layout> 
  </appender>
  
  <appender name="ErrorAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
    <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/error.log" />
    <param name="MaxBackupIndex" value="5" />
    <param name="MaxFileSize" value="20MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %c [%t] %x - %m%n"/>
    </layout>
    <filter class="org.apache.log4j.varia.LevelRangeFilter">
      <param name="LevelMax" value="fatal"/>
      <param name="LevelMin" value="warn"/>
      <param name="AcceptOnMatch" value="true"/>
    </filter>
  </appender>
  
  <appender name="PersistenceAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
    <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/persistence.log" />
    <param name="MaxBackupIndex" value="3" />
    <param name="MaxFileSize" value="50MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %c %x - %m%n"/>
    </layout>
  </appender>
  
  <appender name="LoggingAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
    <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/logging.log" />
    <param name="MaxBackupIndex" value="3" />
    <param name="MaxFileSize" value="10MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %c %x - %m%n"/>
    </layout>
  </appender>
  
  <appender name="FallbackConsoleAppender" class="org.apache.log4j.ConsoleAppender">
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %c %x - %m%n"/>
    </layout> 
  </appender>
  
  <appender name="SourceDataTagAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
      <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/IncomingSourceTag.log" />
    <param name="MaxBackupIndex" value="10" />
    <param name="MaxFileSize" value="5MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyy-MM-dd HH:mm:ss.SSS} %m%n"/>
    </layout>
  </appender>
  
  <appender name="RuleTagAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
      <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/RuleTag.log" />
    <param name="MaxBackupIndex" value="1" />
    <param name="MaxFileSize" value="5MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyy-MM-dd HH:mm:ss.SSS} %m%n"/>
    </layout>
  </appender>
  
  <appender name="BenchmarkDataTagAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
      <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/BenchmarkDataTag.log" />
    <param name="MaxBackupIndex" value="1" />
    <param name="MaxFileSize" value="5MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyy-MM-dd HH:mm:ss.SSS} %m%n"/>
    </layout>
  </appender>

  <appender name="BenchmarkPriorityAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
      <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/BenchmarkPriority.log" />
    <param name="MaxBackupIndex" value="6" />
    <param name="MaxFileSize" value="5MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyy-MM-dd HH:mm:ss.SSS} %m%n"/>
    </layout>
  </appender>
  
  <appender name="LaserAlarmsAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
      <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${c2mon.log.dir}/laser.log" />
    <param name="MaxBackupIndex" value="1" />
    <param name="MaxFileSize" value="5MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyy-MM-dd HH:mm:ss.SSS} %m%n"/>
    </layout>
  </appender>  
  
  <appender name="AdministratorEmailSynch" class="org.apache.log4j.net.SMTPAppender">
    <param name="BufferSize" value="1" /> 
  	<param name="SMTPHost" value="cernmx.cern.ch" />
  	<param name="From" value="tim.support@cern.ch" />
  	<param name="To" value="mark.brightwell@cern.ch,Matthias.Braeger@cern.ch" />
  	<param name="Subject" value="C2MON server warning" />
  	<layout class="org.apache.log4j.PatternLayout">
  	  <param name="ConversionPattern" value="%-d{yyy-MM-dd HH:mm:ss.SSS} %m%n" />
  	</layout>
  	<filter class="org.apache.log4j.varia.LevelRangeFilter">
    	<param name="LevelMin" value="error" />
    	<param name="LevelMax" value="fatal" />
  	</filter>
  </appender>
  
   <appender name="AdministratorEmail" class="org.apache.log4j.AsyncAppender">
    <param name="BufferSize" value="1"/>
    <appender-ref ref="AdministratorEmailSynch"/>
   </appender>
  
  <appender name="AdminSmsAppenderSynch" class="org.apache.log4j.net.SMTPAppender">
  	<param name="BufferSize" value="1" />  	 
  	<param name="SMTPHost" value="cernmx.cern.ch" />
  	<param name="From" value="tim.support@cern.ch" />
  	<param name="To" value="0041764878739@mail2sms.cern.ch,0041764875788@mail2sms.cern.ch" />
  	<param name="Subject" value="C2MON server warning" />
  	<layout class="org.apache.log4j.PatternLayout">
  	  <param name="ConversionPattern" value="%m" />
  	</layout>
  	<filter class="org.apache.log4j.varia.LevelRangeFilter">
    	<param name="LevelMin" value="info" />
    	<param name="LevelMax" value="fatal" />
  	</filter>
  </appender>
  
   <appender name="AdminSmsAppender" class="org.apache.log4j.AsyncAppender">
    <param name="BufferSize" value="1"/>
    <appender-ref ref="AdminSmsAppenderSynch"/>
   </appender>
  
  <appender name="CentralLoggingAppender" class="cern.cmw.log.sources.log4j.CmwLogAppender">    
    <param name="domain" value="TIM" />
    <param name="subDomain" value="C2MON-server" />
    <param name="threshold" value="WARN" />
    <param name="sourceName" value="${c2mon.process.name}" />
    <param name="serverName" value="cmw-log-pro:6200" />
  </appender>
  
  <!-- 
    Define the loggers.
  -->
  <logger name="BenchmarkDataTag"  additivity="false">
    <level value="info"/>
    <appender-ref ref="BenchmarkDataTagAppender"/>
  </logger>
  <logger name="BenchmarkPriority"  additivity="false">
    <level value="info"/>
    <appender-ref ref="BenchmarkPriorityAppender"/>
  </logger>
  <logger name="SourceDataTagLogger"  additivity="false">
    <level value="info"/>
    <appender-ref ref="SourceDataTagAppender"/>
  </logger>
  <logger name="RuleTagLogger"  additivity="false">
    <level value="info"/>
    <appender-ref ref="RuleTagAppender"/>
  </logger>
  <logger name="LaserAlarmsLogger"  additivity="false">
    <level value="info"/>
    <appender-ref ref="LaserAlarmsAppender"/>
  </logger>  
  <logger name="org.apache.activemq"  additivity="false">
    <level value="info"/>
    <appender-ref ref="FileAppender"/>
    <appender-ref ref="ErrorAppender"/>
    <appender-ref ref="CentralLoggingAppender"/>
  </logger>
  <logger name="org.springframework"  additivity="false">
    <level value="info"/>
    <appender-ref ref="FileAppender"/>
    <appender-ref ref="ErrorAppender"/>
  </logger>
  <logger name="cern.c2mon"  additivity="false">
    <level value="all"/>
    <appender-ref ref="FileAppender"/>
    <appender-ref ref="ErrorAppender"/>   
    <appender-ref ref="CentralLoggingAppender"/>
  </logger>
  <logger name="cern.c2mon.server.shorttermlog"  additivity="false">
    <level value="info"/>
    <appender-ref ref="ErrorAppender"/>
    <appender-ref ref="LoggingAppender"/>   
    <appender-ref ref="CentralLoggingAppender"/>
  </logger>
  <logger name="cern.c2mon.pmanager"  additivity="false">
    <level value="info"/>    
    <appender-ref ref="ErrorAppender"/>  
    <appender-ref ref="LoggingAppender"/>
    <appender-ref ref="CentralLoggingAppender"/>
  </logger>
  <logger name="cern.c2mon.server.cachepersistence"  additivity="true">
    <level value="debug"/>    
    <appender-ref ref="PersistenceAppender"/>
    <appender-ref ref="CentralLoggingAppender"/>
  </logger>   
  <logger name="AdminSmsLogger"  additivity="false">
    <level value="info"/>
    <appender-ref ref="AdminSmsAppender"/>
    <appender-ref ref="FileAppender"/>
  </logger>
  <logger name="AdminEmailLogger"  additivity="false">
    <level value="info"/>
    <appender-ref ref="AdministratorEmail"/>    
  </logger>
  <logger name="ShortTermLogFallbackLogger"  additivity="false">
    <level value="debug"/>
    <appender-ref ref="LoggingAppender"/>    
  </logger>
  <root>
    <level value="info"/>
    <appender-ref ref="FileAppender" />
    <appender-ref ref="ErrorAppender"/>    
    <appender-ref ref="CentralLoggingAppender"/>
  </root>
</log4j:configuration>
