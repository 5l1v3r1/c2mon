<?xml version="1.0" encoding="UTF-8"?>
<products>
	<product name="c2mon">

		<!--
			this application section is a parent configuration for both
			c2mon-dmn2-prod and c2mon-dmn2-test
		-->
		<application name="default"> 
			<deployment installLocation="/opt/c2mon-dmn2">
				<backupPolicy keepBackups="2">
					<preserve type="dir" name="log" />
				</backupPolicy>
				<notification>
					<!-- you can give more than one mail for deployment notification -->
					<mail address="timdiamon-developers@cern.ch" />
				</notification>
				<startscript name="C2MON-SERVER-DMN2">
					<main-class name="cern.tim.server.lifecycle.ServerStartup"/>
					<vm-args>-Xms2048m -Xmx2048m -XX:+PrintGCDetails -XX:+UseParallelGC -XX:MaxGCPauseMillis=100</vm-args>
					<property name="server.process.name" value="C2MON-SERVER-DMN2"/>
					<property name="c2mon.home" value="$INSTALL_PATH"/>
					<property name="c2mon.log.dir" value="log"/>
					<property name="c2mon.properties.location" value="conf/.c2mon.properties"/>
					<property name="log4j.configuration" value="conf/log4j.xml"/>
					<property name="com.sun.management.jmxremote.port" value="9523"/>
					<property name="com.sun.management.jmxremote.password.file" value="conf/.jmxremote.passwd"/>
					<property name="com.sun.management.jmxremote.access.file" value="conf/.jmxremote.access"/>
					<property name="com.sun.management.jmxremote.ssl" value="false"/>
					<property name="c2mon.home" value="$INSTALL_DIR" />
					<preExec>
					<![CDATA[
####################
# Terracotta module libraries
#
TERRACOTTA_HOME=
TC_MOD_HOME=$TERRACOTTA_HOME/platform/modules/org/terracotta/modules
TERRACOTTA_JARS=$TC_MOD_HOME/tim-distributed-cache/1.3.2/tim-distributed-cache-1.3.2.jar:$TC_MOD_HOME/tim-ehcache-2.0/1.5.2/tim-ehcache-2.0-1.5.2.jar:$TC_MOD_HOME/tim-concurrent-collections/1.3.2/tim-concurrent-collections-1.3.2.jar:$TC_MOD_HOME/tim-async-processing/1.3.2/tim-async-processing-1.3.2.jar:$TC_MOD_HOME/tim-annotations/1.5.1/tim-annotations-1.5.1.jar
TC_PORT=9510
TC_HOST=cs-ccr-tim4
TERRACOTTA_CONFIG=$TC_HOST:$TC_PORT
####################
					
# Run in cluster mode
#
if [ "$2" != "single" ]; then
    CLUSTER_JAVA_ARGS="-Dcom.tc.l1.cachemanager.percentageToEvict=10 \
                   -Dcom.tc.l1.cachemanager.threshold=70 \
                   -Dcom.tc.l1.cachemanager.monitorOldGenOnly=false \
                   -Dtc.config=$TERRACOTTA_CONFIG \
                   -Dcern.c2mon.cache.mode=multi"

    JARS=$JARS:$TERRACOTTA_JARS
    JVM_OPTS="$COMMON_JAVA_ARGS CLUSTER_JAVA_ARGS"
    JAVA_EXEC=$TERRACOTTA_HOME/bin/dso-java.sh
else
    JVM_OPTS=$COMMON_JAVA_ARGS
fi
]]>
					
					</preExec>
				</startscript>
			</deployment>
		</application>

		<application name="c2mon-dmn2-prod" extends="default">
			<deployment>
				<directory name="conf">
					<file name=".jmxremote.passwd" sourceDir="/user/diamonop/c2mon/prod/conf/"
						mask="400" />
					<file name=".jmxremote.access" sourceDir="/user/diamonop/c2mon/prod/conf/"
						mask="400" />
					<file name=".c2mon.properties" sourceDir="/user/diamonop/c2mon/prod/conf/"
						mask="400" />
				</directory>
				
			</deployment>
		</application>

		<application name="c2mon-dmn2-test" extends="default" >
			<deployment installLocation="/opt/c2mon-dmn2-test">
				<directory name="conf">
					<file name=".jmxremote.passwd" sourceDir="/user/diamonop/c2mon/test/conf/"
						mask="400" />
					<file name=".jmxremote.access" sourceDir="/user/diamonop/c2mon/test/conf/"
						mask="400" />
					<file name=".c2mon.properties" sourceDir="/user/diamonop/c2mon/test/conf/"
						mask="400" />
				</directory>
			</deployment>
		</application>

	</product>
</products>