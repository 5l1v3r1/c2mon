<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">

<!--
  INSTRUCTIONS:

  Specify the name of the log file in the ${tim.log.filename} system property.
  To do this, start your program the following way:

    java -Dtim.log.path=c:/  ... YourMainClass
  or
    java -Dtim.log.path=c:/  ... -jar YourRunnableJar.jar

  If you don't, the log file will be created in the temp directory. If this
  isn't possible either, log output will be printed on the console.

  Messages are written to the log file in an asynchronous way (no flush after
  every line). To avoid losing messages when the program exits, you have to
  shutdown the loggers properly before the program terminates. The statement

    LogManager.getLoggerRepository.shutdown();

  closes all loggers and flushes all buffers. If the program crashes violently,
  you might lose some messages that were not written to the file yet.

-->

<!--

  Set the threshold to "info" in production system. This will filter out all
  debug messages. If you only want to enable/disable debugging for certain
  parts of the system, change the "level" attribute of the appropriate logger.

-->
<log4j:configuration debug="false"
                     threshold="warn"
                     xmlns:log4j='http://jakarta.apache.org/log4j/'>
   
  <renderer renderedClass="ch.cern.tim.shared.datatag.FilteredDataTagValue"
          renderingClass="ch.cern.tim.shared.datatag.FilteredDataTagValueRenderer" />


  <!--
    Create a RollingFileAppender.
    Log messages are written to the file specified in the ${tim.log.file}
    system property. The file size is limited to 10MB; once this size is reached
    the file is truncated and backed up and a new file is started.
    If the specified file cannot be opened or the ${tim.log.file} property
    has not been specified on the command line, the FallbackFileAppender is used
    instead.
  -->
  <appender name="FileAppender" class="org.apache.log4j.RollingFileAppender">
    <errorHandler class="org.apache.log4j.varia.FallbackErrorHandler">
      <root-ref/>
      <appender-ref ref="FallbackConsoleAppender"/>
    </errorHandler>
    <param name="Append" value="true" />
    <param name="File" value="${tim.log.path}/${tim.process.name}.log" />
    <param name="MaxBackupIndex" value="1" />
    <param name="MaxFileSize" value="10MB" />
    <param name="BufferedIO" value="false" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %c %x - %m%n"/>
    </layout>
  </appender>

  <appender name="SourceDataTagLoggerAppender" class="org.apache.log4j.RollingFileAppender">
    <param name="Append" value="true" />
    <param name="File" value="${tim.log.path}/${tim.process.name}.tag.log" />
    <param name="MaxFileSize" value="5MB" />
    <param name="MaxBackupIndex" value ="1" />
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyy-MM-dd HH:mm:ss.SSS} %m%n"/>
    </layout>
  </appender>
  
  <appender name="ShortTermLogFallbackAppender" class="org.apache.log4j.RollingFileAppender">
    <param name="Append" value="true" />
    <param name="File"   value="${tim.log.path}/ShortTermLogFallbackLogger.log" />
    <param name="MaxBackupIndex" value="5" />
    <param name="MaxFileSize" value="10MB" />
    <param name="BufferedIO" value="false" />   
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyy-MM-dd HH:mm:ss.SSS} %m%n"/>
    </layout>
  </appender>

<!--
    Create a ConsoleAppender.
    Log messages are written to the console in case neither the FileAppender
    nor the FallbackFileAppender work.
  -->
  <appender name="FallbackConsoleAppender" class="org.apache.log4j.ConsoleAppender">
    <layout class="org.apache.log4j.PatternLayout">
      <param name="ConversionPattern" value="%-d{yyyy-MM-dd HH:mm:ss.SSS} %-5p %c %x - %m%n"/>
    </layout>
</appender>

  <!--
    Define the root logger.
    Debug messages are enabled on the root logger level. The AsyncAppender is
    used for all log output.
  -->
  <logger name="SourceDataTagLogger" additivity="false">
    <level value="info"/>
    <appender-ref ref="SourceDataTagLoggerAppender" />
  </logger>

  <logger name="ShortTermLogFallbackLogger" additivity="false">
    <level value="debug"/>
    <appender-ref ref="ShortTermLogFallbackAppender" />
  </logger>

  <root>
    <level value="debug"/>
    <appender-ref ref="FileAppender" />
  </root>

</log4j:configuration>
